<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå üíú</title>
<link href="https://fonts.googleapis.com/css2?family=Mali:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#a5c9ff; --purple:#d6b8ff; --white:#fff; --bg:#f5f7ff;
  --text:#333; --shadow:0 4px 10px rgba(0,0,0,0.05); --radius:18px;
}
body{
  font-family:'Mali',sans-serif; background:var(--bg); margin:0; max-width:430px; margin:0 auto;
}
header{
  background:linear-gradient(90deg,var(--blue),var(--purple));
  color:white; text-align:center; padding:12px 0; font-weight:600;
  border-bottom-left-radius:var(--radius); border-bottom-right-radius:var(--radius);
}
.profile-box, .friends-box{
  background:var(--white); margin:12px; padding:12px; border-radius:var(--radius); box-shadow:var(--shadow);
}
.profile-box img{
  width:100px; height:100px; border-radius:50%; object-fit:cover; display:block; margin:0 auto 8px auto;
  border:2px solid var(--purple);
}
input, select, button{width:100%; padding:8px; margin:6px 0; border-radius:12px; border:1px solid #ddd; font-family:'Mali'; font-size:1rem;}
button{background:linear-gradient(135deg,var(--purple),var(--blue)); color:white; border:none; cursor:pointer;}
.friends-box ul{list-style:none; padding:0;}
.friends-box li{margin:6px 0; padding:6px; border-radius:12px; background:#f0f0ff; display:flex; align-items:center;}
.friends-box li img{width:40px; height:40px; border-radius:50%; margin-right:8px;}
</style>
</head>
<body>

<header>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå üíú</header>

<div class="profile-box">
  <img id="profileImage" src="realpal/avatar1.png" alt="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
  <input type="file" id="profileUpload" accept="image/*">
  <input type="text" id="realName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
  <input type="text" id="avatarName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏ß‡∏≤‡∏ï‡∏≤‡∏£‡πå">
  <button id="saveProfile">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå üí´</button>
</div>

<div class="friends-box">
  <h3>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
  <ul id="friendsList"></ul>
  <input type="text" id="friendId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô">
  <input type="text" id="friendAnswer" placeholder="‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô">
  <button id="addFriendBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô üíú</button>
</div>

<script type="module">
import { loadProfile, updateProfile, addFriend, loadFriends } from "./js/profile.js";

// ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°
async function initProfile(){
  const profile = await loadProfile();
  document.getElementById("profileImage").src = profile.profile || "realpal/avatar1.png";
  document.getElementById("realName").value = profile.realName || "";
  document.getElementById("avatarName").value = profile.avatarName || "";
  loadFriendsList();
}

async function loadFriendsList(){
  const friends = await loadFriends();
  const ul = document.getElementById("friendsList");
  ul.innerHTML = "";
  friends.forEach(f=>{
    const li = document.createElement("li");
    li.innerHTML = `<img src="realpal/avatar1.png" alt="avatar"><span>${f}</span>`;
    ul.appendChild(li);
  });
}

// ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ preview
document.getElementById("profileUpload").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = ()=> document.getElementById("profileImage").src = reader.result;
    reader.readAsDataURL(file);
  }
});

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
document.getElementById("saveProfile").addEventListener("click", async ()=>{
  const profileFile = document.getElementById("profileUpload").files[0];
  const realName = document.getElementById("realName").value.trim();
  const avatarName = document.getElementById("avatarName").value.trim();

  try{
    await updateProfile({realName, avatarName, profileFile});
    alert("üå∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
  }catch(err){
    alert("‚ùå "+err.message);
  }
});

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
document.getElementById("addFriendBtn").addEventListener("click", async ()=>{
  const friendId = document.getElementById("friendId").value.trim();
  const answer = document.getElementById("friendAnswer").value.trim();

  try{
    await addFriend(friendId, answer);
    alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    loadFriendsList();
  }catch(err){
    alert("‚ùå "+err.message);
  }
});

initProfile();
</script>

</body>
</html>
